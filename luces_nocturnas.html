<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Curso: Geoanálisis - Luces Nocturnas con GEE</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./john_snow.html" rel="next">
<link href="./espacial_r.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

<script src="site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<script src="site_libs/htmlwidgets-1.6.2/htmlwidgets.js"></script>
<script src="site_libs/jquery-1.12.4/jquery.min.js"></script>
<link href="site_libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-1.3.1/leaflet.js"></script>
<link href="site_libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="site_libs/proj4-2.6.2/proj4.min.js"></script>
<script src="site_libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="site_libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="site_libs/leaflet-binding-2.1.2/leaflet.js"></script>
<script src="site_libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="site_libs/leaflet-providers-plugin-2.1.2/leaflet-providers-plugin.js"></script>
<link href="site_libs/HomeButton-0.0.1/home-button.css" rel="stylesheet">
<script src="site_libs/HomeButton-0.0.1/home-button.js"></script>
<script src="site_libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="site_libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="site_libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet">
<link href="site_libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet">


<link rel="stylesheet" href="styles/style.css">
</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./espacial_r.html">Anexos</a></li><li class="breadcrumb-item"><a href="./luces_nocturnas.html">Luces Nocturnas con GEE</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Curso: Geoanálisis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Antecedentes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_estad_esp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Estadística Espacial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datos_espaciales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Datos Espaciales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datos_vectoriales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Datos Vectoriales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Datos tipo Raster</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inferencia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Inferencia Espacial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./autocorrelacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Autocorrelación Espacial</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tareas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tarea_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tarea 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tarea_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tarea 2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Anexos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./espacial_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Objetos Espaciales en R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./luces_nocturnas.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Luces Nocturnas con GEE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./john_snow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mapa de Cólera</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link active" data-scroll-target="#objetivos">Objetivos</a></li>
  <li><a href="#metodología" id="toc-metodología" class="nav-link" data-scroll-target="#metodología">Metodología</a></li>
  <li><a href="#producto-satelital" id="toc-producto-satelital" class="nav-link" data-scroll-target="#producto-satelital">Producto Satelital</a></li>
  <li><a href="#cálculo" id="toc-cálculo" class="nav-link" data-scroll-target="#cálculo">Cálculo</a>
  <ul class="collapse">
  <li><a href="#cargar-librerías" id="toc-cargar-librerías" class="nav-link" data-scroll-target="#cargar-librerías">Cargar Librerías</a></li>
  <li><a href="#definición-de-área-de-estudio" id="toc-definición-de-área-de-estudio" class="nav-link" data-scroll-target="#definición-de-área-de-estudio">Definición de Área de Estudio</a></li>
  <li><a href="#lectura-de-producto-satelital" id="toc-lectura-de-producto-satelital" class="nav-link" data-scroll-target="#lectura-de-producto-satelital">Lectura de Producto Satelital</a></li>
  <li><a href="#ln-ind" id="toc-ln-ind" class="nav-link" data-scroll-target="#ln-ind">Cálculo de Indicador</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Luces Nocturnas con GEE</h1>
<p class="subtitle lead">Índice de Luminosidad Nocturna</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="objetivos" class="level2">
<h2 class="anchored" data-anchor-id="objetivos">Objetivos</h2>
<p>Construir un indicador territorial que represente la luminosidad nocturna, cuya unidad mínima sea manzana urbana y entidad rural, a nivel país que se denominará “Indicador de Iluminosidad Nocturna (ILN).</p>
</section>
<section id="metodología" class="level2">
<h2 class="anchored" data-anchor-id="metodología">Metodología</h2>
<p>De forma general se utilizará como base producto satelital llamado <strong>VIIRS Stray Light Corrected Nighttime Day/Night Band Composites Version 1</strong>, que entrega valores de radiancia media mensual del infrarojo visible, utilizando la plataflorma de GEE para su adquisición y procesamiento.</p>
<p>Se definirá una región de estudio, paral el caso práctico de cálculo es la área urbana de las comunas de Valparaíso y Viña del Mar en la V Región, se le aplicará un buffer de 1000 metros y se cortará imagen tipo raster obtendida del producto satelital antes mecionado.</p>
<p>Finalmente se procederá extraer el valor de indicador por unidad territorial mínima, manzana urbana y entidad censal, mediante el cáculo del promedio de los valores de pixeles que contiene en su interior, y este valor será el del indicador ILN. Para tener control de flujo de este proceso se rezarará mediante un ciclo interativo por Distrito censal, en caso de caerse la conexión con GEE, se puede continuar en el distrito correcto, sin perder lo avanzado.</p>
</section>
<section id="producto-satelital" class="level2">
<h2 class="anchored" data-anchor-id="producto-satelital">Producto Satelital</h2>
<dl>
<dt>Nombre:</dt>
<dd>
<p><a href="https://developers.google.com/earth-engine/datasets/catalog/NOAA_VIIRS_DNB_MONTHLY_V1_VCMSLCFG"><strong>VIIRS Stray Light Corrected Nighttime Day/Night Band Composites Version 1</strong></a></p>
</dd>
<dt>Descripción:</dt>
<dd>
<p>Imágenes compuestas de radiancia media mensual utilizando datos nocturnos del Visible Infrared Imaging Radiometer Suite (VIIRS) Day/Night Band (DNB).</p>
<p>Como estos datos se componen mensualmente, hay muchas zonas del planeta en las que es imposible obtener una cobertura de datos de buena calidad para ese mes. Esto puede deberse a la nubosidad, especialmente en las regiones tropicales, o a la iluminación solar, como ocurre hacia los polos en sus respectivos meses de verano. Por lo tanto, se recomienda que los usuarios de estos datos utilicen la banda ‘cf_cvg’ y no asuman que un valor de cero en la imagen de radiancia media significa que no se observaron luces.</p>
<p>La cobertura de nubes se determina utilizando el producto VIIRS Cloud Mask (VCM). Además, los datos cercanos a los bordes de la franja no se incluyen en los compuestos (zonas de agregación 29-32). La versión 1 NO ha sido filtrada para separar las luces de la aurora, los incendios, los barcos y otras luces temporales. Esta separación está en desarrollo y se incluirá en una versión posterior de esta serie temporal. También está en desarrollo un método para separar las luces de los valores de fondo (no luces).</p>
<p>Este producto es una configuración alternativa del DNB de VIIRS que utiliza un procedimiento para corregir la luz parásita. El procedimiento de corrección extiende las áreas visibles más cerca de los polos y mejora el rango dinámico. Hay que tener en cuenta que se introducen algunos artefactos debido al procedimiento utilizado en las regiones crepusculares; véase el documento de referencia para más detalles. Este producto excluye los datos afectados por la nubosidad.</p>
</dd>
<dt>Bandas:</dt>
<dd>
<p><strong>Resolution</strong>: 463.83 meters</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-striped table-hover table-condensed table-sm small" data-quarto-postprocess="true">
<caption>Información de Producto Satelital</caption>
<thead>
<tr class="header">
<th style="text-align: center;" data-quarto-table-cell-role="th">Name</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Units</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Min</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Max</th>
<th style="text-align: center;" data-quarto-table-cell-role="th">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">avg_rad</td>
<td style="text-align: center;">nanoWatts/cm2/sr</td>
<td style="text-align: center;">-1.5*</td>
<td style="text-align: center;">193565*</td>
<td style="text-align: center;">Average DNB radiance values.</td>
</tr>
<tr class="even">
<td style="text-align: center;">cf_cvg</td>
<td style="text-align: center;">NA</td>
<td style="text-align: center;">0*</td>
<td style="text-align: center;">84*</td>
<td style="text-align: center;">Cloud-free coverages; the total number of observations that went into each pixel. This band can be used to identify areas with low numbers of observations where the quality is reduced.</td>
</tr>
</tbody>
</table>


</div>
</div>
</dd>
</dl>
<ul>
<li><em>Estimated min or max value</em></li>
</ul>
</section>
<section id="cálculo" class="level2">
<h2 class="anchored" data-anchor-id="cálculo">Cálculo</h2>
<p>A continuación se define el flujo de trabajo para calcular el indicador de ILN.</p>
<section id="cargar-librerías" class="level3">
<h3 class="anchored" data-anchor-id="cargar-librerías">Cargar Librerías</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mapview)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(viridis)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rgee)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ee_Initialize</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>── rgee 1.1.7 ─────────────────────────────────────── earthengine-api 0.1.374 ── 
 ✔ user: not_defined 
 ✔ Initializing Google Earth Engine:
 ✔ Initializing Google Earth Engine:  DONE!

 ✔ Earth Engine account: users/denisberroeta 

 ✔ Python Path: /opt/homebrew/Caskroom/miniforge/base/envs/gee/bin/python 
──────────────────────────────────────────────────────────────────────────────── </code></pre>
</div>
</div>
</section>
<section id="definición-de-área-de-estudio" class="level3">
<h3 class="anchored" data-anchor-id="definición-de-área-de-estudio">Definición de Área de Estudio</h3>
<p>Para este ejemplo se definirá como área de estudio las zonas urbanas del gran Valparaíso. Para esto tenemos un archivo tipo llamado <code>Zonas_Censales_2017_Nacional.rds</code> tipo polígonos espaciales, que corresponden a zonas censales (INE) que son urbanas únicamente. Estas geometrías se utilizarán únicamente para definir la región de estudio.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>zonas_ine <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/censo/zonas_urb_consolidadas.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación utilizaremos las zonas censales, para definir una región de estudio general, filtrando las comuna de nuestro interés en este caso las comunas de Valparaíso y Viña del Mar.Debemos tener especial cuidado en el Sistema de Referencias de Coordenadas (CRS), ya que necesitamos que en coordenadas geográfica EPSG(4326), si está en algún otro CRS, se puede transformar utilizando la función <code>st_transform()</code>. Posterriormente se ibuja una geometría única que toma solamente el contorno de las zonas censales filtradas utilizando la función <code>st_union</code>. Finalmente a esta geometría única se le aplicarà un buffer (<code>st_buffer()</code>) de 1000 metros, a fin de asegurarnos que no queden partes de polígonos sin curbrir con el raster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mis_comunas <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"VALPARAÍSO"</span>, <span class="st">"VIÑA DEL MAR"</span>)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>ae <span class="ot">&lt;-</span> zonas_ine <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NOM_COMUNA <span class="sc">%in%</span> mis_comunas) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_union</span>() <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_buffer</span>(<span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>A continuación se visualiza el área de</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(ae)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-cc40087619730be3db2d" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-cc40087619730be3db2d">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-71.67030168188423,-71.67030168188421,-71.67326809613969,-71.67326809613969,-71.67623448391132,-71.67623448391132,-71.67920084517522,-71.68365033731688,-71.68365033731688,-71.68513348808439,-71.68513348808439,-71.68809976968194,-71.69106602467632,-71.69106602467632,-71.69254914218988,-71.69254914218988,-71.69699845476013,-71.69996462980187,-71.69996462980187,-71.70293077814497,-71.70293077814497,-71.70589689976562,-71.70589689976562,-71.70589689976562,-71.70589689976562,-71.70589689976562,-71.70589689976562,-71.70737995054756,-71.70737995054756,-71.70886299463996,-71.70886299463996,-71.70886299463996,-71.70886299463996,-71.70589689976562,-71.70589689976562,-71.70367231105629,-71.70367231105629,-71.70293077814497,-71.70293077814497,-71.70293077814497,-71.70293077814497,-71.69996462980187,-71.69996462980187,-71.69996462980187,-71.69699845476013,-71.69699845476013,-71.69477380597225,-71.69477380597225,-71.69403225304367,-71.69403225304367,-71.69106602467632,-71.69106602467632,-71.68216717990752,-71.68216717990752,-71.67920084517522,-71.67623448391132,-71.67326809613969,-71.67030168188423,-71.66733524116873,-71.66436877401712,-71.66140228045322,-71.65843576050092,-71.65546921418407,-71.65250264152654,-71.64953604255219,-71.64953604255219,-71.64879438869939,-71.64879438869939,-71.64656941728488,-71.64656941728488,-71.6436027657485,-71.64360276574851,-71.64063608796691,-71.64063608796691,-71.64063608796691,-71.64063608796691,-71.6405433788636,-71.6405433788636,-71.63766938396395,-71.63766938396395,-71.63766938396395,-71.64063608796691,-71.64063608796691,-71.64211943013687,-71.64211943013687,-71.6436027657485,-71.64360276574851,-71.64063608796691,-71.64063608796691,-71.64063608796691,-71.64360276574851,-71.6436027657485,-71.64360276574851,-71.64656941728488,-71.64656941728488,-71.64953604255219,-71.64953604255219,-71.65176099424922,-71.65176099424922,-71.65250264152654,-71.65250264152654,-71.65398593114639,-71.65398593114639,-71.65546921418407,-71.65546921418407,-71.65843576050092,-71.65843576050092,-71.66140228045322,-71.66436877401711,-71.66733524116873,-71.67030168188423],"lat":[-33.08300721703353,-33.08572451178758,-33.08617396553453,-33.08889120601492,-33.08934059973202,-33.09205778591144,-33.09250711958554,-33.09318097223345,-33.09182236477418,-33.0920469381923,-33.09068830774664,-33.09113738603715,-33.09158638546943,-33.09294503471503,-33.09316950955787,-33.09452814521364,-33.09520146554165,-33.09565024718032,-33.09836751057736,-33.09881623212772,-33.1015334411096,-33.10198210255853,-33.10469925709798,-33.10741633841289,-33.11013334648902,-33.11285028131216,-33.11420872124943,-33.11443306458918,-33.11579149089312,-33.11601581919464,-33.11873262620584,-33.12416602031352,-33.12688260738158,-33.12643385613556,-33.12915035114232,-33.12881372188188,-33.12949283066297,-33.12938060987527,-33.13413423477491,-33.13956667378039,-33.14228278318322,-33.14183376182819,-33.14454977911296,-33.14726572296923,-33.1468165852804,-33.14953243699993,-33.14919551790617,-33.14987446585444,-33.14976214845344,-33.15179896124746,-33.15134962828116,-33.15406529570006,-33.15271676702522,-33.15543230488383,-33.1549826187244,-33.15453285361356,-33.15408300955196,-33.15363308654022,-33.15318308457899,-33.15273300366891,-33.15228284381062,-33.15183260500476,-33.15138228725201,-33.15093189055298,-33.15048141490834,-33.1484449228692,-33.14833229513767,-33.14765345645298,-33.14731554717082,-33.14460016061955,-33.14414956459342,-33.14143412341368,-33.14098346721651,-33.13826797143556,-33.13555240230291,-33.13292162476989,-33.13290754223377,-33.13282267731497,-33.13238608103769,-33.12967038403105,-33.12695461371981,-33.12740525493659,-33.12468939253899,-33.12491467415918,-33.12355671078009,-33.12378196797478,-33.11699185282848,-33.11654136571837,-33.11382521028289,-33.11110898162345,-33.11155943110855,-33.1034102494568,-33.09254364958398,-33.09299388837758,-33.09027703673955,-33.09072717782879,-33.08801023423779,-33.08834777417108,-33.08766852331775,-33.08778102559424,-33.08574324209051,-33.08596822479121,-33.08460967490349,-33.08483463317977,-33.08347606030953,-33.08392590830206,-33.08120868890668,-33.08165843920579,-33.0821081106604,-33.08255770326987,-33.08300721703353]}],[{"lng":[-71.5842642552703,-71.58723142717589,-71.5901985732898,-71.59316569358818,-71.59316569358818,-71.59464924404905,-71.59464924404907,-71.5961327880471,-71.5961327880471,-71.59761632557932,-71.59761632557932,-71.59909985664274,-71.6020668993512,-71.60503391614861,-71.60503391614861,-71.6080009070111,-71.61096787191481,-71.61096787191481,-71.61393481083584,-71.61393481083584,-71.6154182705454,-71.6154182705454,-71.61690172375036,-71.61690172375036,-71.61690172375036,-71.61690172375036,-71.61986861063446,-71.61986861063446,-71.62135204430766,-71.62135204430766,-71.62283547146431,-71.62283547146431,-71.62283547146431,-71.62580230621599,-71.62580230621599,-71.62876911486568,-71.62876911486568,-71.63173589738948,-71.63470265376353,-71.63470265376353,-71.63766938396395,-71.64063608796691,-71.6436027657485,-71.64656941728489,-71.64953604255219,-71.65250264152654,-71.65250264152654,-71.65546921418407,-71.65843576050092,-71.65843576050092,-71.66140228045322,-71.66140228045322,-71.66436877401712,-71.66436877401711,-71.66733524116873,-71.66733524116873,-71.66733524116873,-71.66752064448819,-71.66752064448819,-71.67030168188421,-71.67030168188421,-71.67030168188421,-71.67030168188421,-71.67030168188423,-71.67067248511367,-71.67067248511367,-71.67326809613969,-71.67326809613969,-71.67326809613969,-71.67326809613969,-71.67326809613969,-71.67326809613969,-71.67326809613969,-71.67030168188421,-71.67030168188421,-71.66807685382692,-71.66807685382692,-71.66733524116873,-71.66733524116873,-71.66441512526954,-71.66441512526954,-71.66436877401711,-71.66436877401712,-71.66140228045322,-71.66140228045322,-71.65843576050092,-71.65546921418407,-71.65546921418407,-71.65398593114639,-71.65398593114639,-71.65250264152654,-71.65250264152654,-71.65101934532747,-71.65101934532747,-71.64953604255219,-71.64953604255219,-71.64656941728488,-71.64656941728489,-71.64360276574851,-71.64063608796691,-71.63841106242164,-71.63841106242164,-71.63766938396395,-71.63766938396395,-71.63470265376353,-71.63470265376353,-71.6319213204292,-71.6319213204292,-71.63173589738948,-71.63173589738948,-71.62876911486568,-71.62876911486568,-71.62598773252155,-71.62598773252155,-71.62580230621599,-71.62580230621599,-71.6243188921014,-71.6243188921014,-71.62283547146431,-71.62283547146431,-71.62061032828545,-71.62061032828545,-71.61986861063446,-71.61986861063446,-71.6154182705454,-71.6154182705454,-71.61393481083584,-71.61393481083584,-71.61096787191481,-71.61096787191481,-71.6080009070111,-71.60577566629657,-71.60577566629657,-71.60503391614861,-71.60503391614861,-71.6020668993512,-71.59909985664274,-71.5961327880471,-71.59316569358816,-71.59316569358818,-71.59316569358816,-71.59464924404907,-71.59464924404907,-71.5961327880471,-71.5961327880471,-71.5961327880471,-71.59761632557932,-71.59761632557932,-71.59909985664274,-71.59909985664274,-71.59947073839749,-71.59947073839749,-71.6020668993512,-71.6020668993512,-71.6020668993512,-71.59984161974771,-71.59984161974771,-71.59909985664274,-71.59909985664274,-71.59909985664274,-71.5961327880471,-71.5961327880471,-71.59316569358816,-71.59316569358816,-71.59316569358816,-71.59316569358818,-71.59316569358818,-71.59316569358816,-71.59168213666743,-71.59168213666743,-71.59019857328981,-71.59019857328981,-71.5887150034583,-71.5887150034583,-71.58723142717589,-71.58723142717589,-71.58574784444555,-71.58574784444555,-71.5842642552703,-71.5842642552703,-71.58148250820594,-71.58148250820594,-71.58129705759688,-71.58129705759688,-71.57842256030078,-71.57842256030078,-71.57832983417956,-71.57832983417956,-71.57832983417956,-71.57573349259009,-71.57573349259009,-71.57536258504216,-71.57536258504216,-71.5738789508359,-71.5738789508359,-71.57239531020859,-71.57239531020859,-71.56942800970272,-71.56942800970272,-71.56646068354841,-71.56349333176956,-71.56200964627838,-71.56200964627838,-71.56052595439003,-71.56052595439003,-71.55755855143371,-71.55755855143371,-71.55681669670105,-71.55681669670105,-71.55459112292446,-71.55162366888618,-71.55162366888618,-71.55013993230111,-71.55013993230111,-71.54865618934274,-71.54865618934274,-71.54717244001404,-71.54717244001404,-71.54568868431801,-71.54568868431801,-71.54568868431801,-71.54568868431801,-71.54568868431801,-71.54420492225762,-71.54420492225762,-71.54272115383588,-71.54272115383588,-71.54272115383588,-71.54123737905576,-71.54123737905576,-71.53975359792022,-71.53975359792022,-71.5382698104323,-71.5382698104323,-71.53678601659493,-71.53381840988388,-71.53381840988388,-71.53085077781094,-71.53085077781094,-71.53085077781094,-71.53085077781094,-71.53085077781094,-71.52788312040001,-71.52788312040001,-71.52788312040001,-71.52788312040001,-71.52491543767495,-71.51897999637801,-71.5160122378539,-71.5160122378539,-71.5130444541112,-71.5130444541112,-71.50710881106558,-71.50414095181041,-71.50414095181041,-71.50117306743221,-71.49968911582943,-71.49968911582943,-71.49820515795484,-71.49820515795484,-71.49523722340217,-71.49264026011782,-71.49264026011782,-71.49226926379814,-71.49226926379814,-71.48930127916658,-71.48930127916658,-71.4833652349165,-71.4833652349165,-71.48039717534574,-71.48039717534574,-71.48039717534574,-71.48039717534574,-71.47742909084303,-71.47446098143226,-71.47446098143226,-71.4714928471373,-71.4714928471373,-71.4700087706657,-71.47000877066571,-71.46852468798204,-71.46852468798204,-71.46704059908926,-71.46704059908926,-71.46555650399037,-71.46555650399037,-71.46555650399038,-71.46407240268836,-71.46407240268836,-71.46258829518619,-71.46258829518619,-71.46258829518619,-71.4596200615934,-71.4596200615934,-71.4596200615934,-71.45665180323586,-71.45665180323586,-71.45665180323586,-71.45665180323586,-71.4596200615934,-71.4596200615934,-71.461846239111,-71.461846239111,-71.46258829518619,-71.46258829518619,-71.46555650399037,-71.46555650399038,-71.47408996600576,-71.47408996600576,-71.47446098143226,-71.47446098143226,-71.4714928471373,-71.4714928471373,-71.4714928471373,-71.4714928471373,-71.46852468798204,-71.46852468798204,-71.46852468798204,-71.46778264431161,-71.46778264431161,-71.46555650399038,-71.46555650399037,-71.46258829518619,-71.4596200615934,-71.45665180323586,-71.45516766477779,-71.45516766477779,-71.45368352013749,-71.45368352013749,-71.44774687981375,-71.44774687981376,-71.44626270430713,-71.44626270430713,-71.4447785226362,-71.44181014081335,-71.44181014081335,-71.43884173436913,-71.43884173436913,-71.4358733033274,-71.4358733033274,-71.43290484771208,-71.43290484771208,-71.43290484771208,-71.43290484771208,-71.43290484771208,-71.42993636754706,-71.42993636754706,-71.42993636754706,-71.43290484771208,-71.43290484771208,-71.43290484771208,-71.4358733033274,-71.4358733033274,-71.43874897127127,-71.43874897127127,-71.43884173436913,-71.43884173436913,-71.44032594066742,-71.44032594066742,-71.44181014081335,-71.44181014081335,-71.44181014081335,-71.4447785226362,-71.44700479283117,-71.44700479283117,-71.44774687981376,-71.44774687981375,-71.45071521232215,-71.45071521232215,-71.45368352013749,-71.45368352013749,-71.45665180323586,-71.45665180323586,-71.4596200615934,-71.46258829518619,-71.4654637478407,-71.4654637478407,-71.46555650399038,-71.46555650399037,-71.46852468798204,-71.46852468798204,-71.4714928471373,-71.4714928471373,-71.47446098143226,-71.47446098143226,-71.47742909084303,-71.4796551565565,-71.4796551565565,-71.48039717534576,-71.48039717534576,-71.4833652349165,-71.4833652349165,-71.48633326953141,-71.48633326953141,-71.48930127916658,-71.49078527460929,-71.49078527460931,-71.49226926379814,-71.49226926379814,-71.49449523584882,-71.49449523584882,-71.49523722340219,-71.49523722340217,-71.49801966277967,-71.49801966277967,-71.49820515795484,-71.49820515795484,-71.50117306743221,-71.50117306743221,-71.50562488457987,-71.50562488457987,-71.50710881106558,-71.50710881106558,-71.51007664517378,-71.51007664517378,-71.5130444541112,-71.5160122378539,-71.5160122378539,-71.51897999637801,-71.52194772965966,-71.52194772965966,-71.52491543767495,-71.52788312040001,-71.52788312040001,-71.53085077781094,-71.53085077781094,-71.53604411729616,-71.53604411729616,-71.53678601659493,-71.53678601659493,-71.53901170497012,-71.53901170497012,-71.53975359792022,-71.53975359792022,-71.54272115383588,-71.54272115383588,-71.54568868431801,-71.54865618934274,-71.55162366888618,-71.55459112292446,-71.55459112292446,-71.55607484037171,-71.55607484037171,-71.56052595439003,-71.56052595439003,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56061868532041,-71.56061868532042,-71.56052595439003,-71.56052595439003,-71.55904225610747,-71.55904225610747,-71.55755855143371,-71.55755855143371,-71.55755855143371,-71.55755855143371,-71.55755855143371,-71.56052595439003,-71.56052595439003,-71.56052595439003,-71.56052595439003,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56349333176956,-71.56386425214244,-71.56386425214244,-71.56646068354841,-71.56942800970272,-71.56942800970272,-71.57239531020859,-71.57536258504216,-71.57536258504216,-71.57684621282436,-71.57684621282436,-71.57832983417956,-71.58129705759688,-71.5842642552703],"lat":[-33.01558906864969,-33.01604040998028,-33.01649167256326,-33.01694285639791,-33.0183019956827,-33.01852756282585,-33.01988668869478,-33.02011224090567,-33.02147135335529,-33.02169689063228,-33.02305598965918,-33.02328151200059,-33.02373249761448,-33.02418340446922,-33.02690159550012,-33.02735244259439,-33.02780321092411,-33.03052136719884,-33.03097207575015,-33.02825390048856,-33.0284792157336,-33.02712009607178,-33.02734538687891,-33.02598624428251,-33.02326790453214,-33.02054949205024,-33.02099996711807,-33.01828146292182,-33.01850666142544,-33.01714737731172,-33.01737255137851,-33.01601324433966,-33.01329457574042,-33.01374483631569,-33.01102607603015,-33.0114762388618,-33.00875738689913,-33.0092074519899,-33.0096574383425,-33.0069384757119,-33.00738836432968,-33.00783817421191,-33.00828790535792,-33.00873755776703,-33.00918713143857,-33.00963662637184,-33.01235570291838,-33.01280513808474,-33.01325449450752,-33.01597353628452,-33.01642283292251,-33.01914182093055,-33.01959105777056,-33.02230999198223,-33.02275916901106,-33.02547804939898,-33.0280269336635,-33.02805500690553,-33.02822493032242,-33.0286459931402,-33.03136474687768,-33.03408342780159,-33.03680203589763,-33.03918075822882,-33.03923690386968,-33.03957671708778,-33.0399697041741,-33.04268818547411,-33.048124929434,-33.05356138177862,-33.05899754239378,-33.06443341116535,-33.06715123607412,-33.06670191423088,-33.06941964727894,-33.06908259002375,-33.06976200834217,-33.06964964489178,-33.0716878689303,-33.07124537602977,-33.07128783830375,-33.07128081398646,-33.07395590101633,-33.073506286114,-33.07622374352514,-33.07577403093095,-33.07532423950088,-33.07804158615612,-33.07781665144699,-33.07917529266808,-33.07895033353416,-33.08030895177765,-33.0800839682186,-33.08144256348333,-33.08121755549882,-33.08257612778366,-33.08212604325166,-33.08484311416237,-33.08439293192426,-33.08394267083769,-33.08360492327886,-33.08428416662154,-33.08417157306678,-33.08620927215629,-33.08575883450649,-33.08847568381849,-33.0880533092212,-33.08822310877126,-33.08819494792689,-33.09074190581247,-33.09029127272367,-33.09300793812645,-33.09258538030023,-33.09275516835538,-33.09272699529555,-33.09527378074866,-33.09504837633733,-33.09640663092166,-33.09618120207847,-33.09753943366731,-33.09720124636039,-33.09788035176277,-33.09776761162306,-33.0998048968706,-33.09912833129532,-33.1004864844592,-33.10026091844916,-33.10161904861316,-33.10116784800604,-33.10388403461346,-33.10343273626599,-33.10309421074297,-33.10377323771173,-33.10366038483187,-33.10569743476998,-33.10524595980018,-33.10479440595175,-33.1043427732254,-33.10389106162181,-33.10660698870492,-33.10796492481575,-33.10819080463575,-33.10954872717547,-33.10977459199268,-33.11249039162882,-33.11656395385872,-33.11678982253308,-33.11814764472344,-33.11837349838741,-33.12074965142352,-33.12080611381925,-33.12114555997086,-33.12154076428269,-33.12425630878779,-33.12697178004304,-33.12663300892831,-33.12731186176359,-33.12719892701762,-33.12923545451704,-33.13195076040078,-33.1314989391367,-33.13421415290396,-33.13376223389035,-33.1364773555321,-33.13919240386679,-33.14190737888024,-33.14462228055827,-33.14733710888673,-33.14711107273012,-33.1484684546815,-33.14824239408714,-33.14959975299413,-33.14937366796172,-33.15073100382319,-33.15050489435237,-33.15186220716721,-33.15163607325766,-33.15299336302475,-33.15276720467614,-33.15412447139434,-33.15370036247604,-33.15387001842365,-33.15384174195511,-33.15638654566389,-33.15594820388132,-33.15603302899121,-33.1560188876817,-33.15864842996424,-33.16136272392659,-33.16096670355724,-33.16130598308347,-33.16124940351617,-33.16362432601875,-33.16339798718523,-33.16475505581504,-33.16452869253997,-33.16859977416316,-33.16814696018738,-33.17086090398612,-33.17040799224068,-33.16995500152205,-33.16972847654801,-33.17108539739844,-33.17085884798009,-33.17221574576372,-33.17176257829386,-33.16972723883605,-33.16961393815538,-33.16893548366311,-33.16859555553417,-33.16814224892997,-33.16678534263865,-33.16655866442823,-33.16520174448426,-33.16497505123843,-33.16361811764524,-33.16339140936564,-33.16203446212661,-33.1618077388149,-33.1590937987028,-33.15637978520103,-33.15366569832374,-33.15230862737369,-33.15208191730114,-33.15072483272613,-33.15049810763117,-33.14778389290415,-33.14642675804157,-33.14620002735793,-33.14484287888188,-33.1446161331813,-33.1432589710952,-33.14303221037932,-33.14167503468659,-33.14144825895707,-33.14099464830046,-33.13828027027201,-33.13782659957433,-33.13511216716667,-33.12968308260505,-33.12425370514283,-33.12153890660945,-33.12108527043769,-33.1183704176462,-33.11565549169086,-33.11294049258586,-33.11248683431304,-33.11157928110549,-33.11112538617229,-33.10841038972457,-33.10795643486422,-33.11067141235382,-33.1097632280641,-33.10930901759438,-33.11202386508699,-33.11156955676564,-33.11134237302289,-33.11269975512747,-33.11247254692072,-33.11382990600486,-33.11337542094065,-33.11297768179676,-33.11331701426514,-33.11326018916049,-33.11563548237623,-33.11518082056097,-33.11246621414951,-33.11155669181327,-33.10884205027106,-33.10838718976818,-33.10567249414245,-33.10295772545471,-33.10024288371914,-33.09978800135389,-33.09933304012141,-33.09661816338629,-33.09616314231042,-33.09480568607637,-33.09457815072263,-33.09322068099688,-33.09299313068676,-33.09163564747274,-33.09140808220791,-33.09005058550904,-33.08982300529118,-33.08710796669034,-33.08575042003135,-33.08552283438716,-33.08416527425486,-33.08393767366314,-33.08122250822682,-33.07850726986969,-33.07805204768235,-33.07533675548979,-33.06990595245558,-33.06945070867296,-33.06673521694871,-33.06401965238396,-33.06130401499295,-33.06175920149492,-33.05904347218911,-33.05938479602175,-33.05870584873772,-33.05881961230396,-33.05678273957017,-33.05723773025604,-33.05452181714772,-33.05582942150106,-33.05548992038102,-33.05554675767055,-33.0531702158957,-33.05271549981345,-33.04999940293875,-33.04456699091205,-33.03913428794398,-33.03867958863582,-33.03596314721259,-33.03392576844288,-33.03381208967734,-33.03313295553188,-33.03279189328515,-33.03007532564158,-33.02962052620251,-33.029165648,-33.02871069103489,-33.02848318301661,-33.02984144240594,-33.02961390990743,-33.03097214634598,-33.03006180028325,-33.02870358300694,-33.02847595205572,-33.0271177214132,-33.02689007556464,-33.02643472479873,-33.02371823781228,-33.0232628274707,-33.0205462870671,-33.02009081716328,-33.01737422337003,-33.01691869391743,-33.01420204676203,-33.01148532705951,-33.00876853482417,-33.00605167007026,-33.00559613873354,-33.00016223018439,-32.99744516719604,-32.99790064084007,-32.99518348615481,-32.99246625902242,-32.99292161547451,-32.990204296664,-32.99064532952995,-32.9905604115675,-32.9905746371856,-32.98794214468727,-32.98816973480301,-32.98681099759569,-32.98703856322505,-32.98567980310392,-32.98296222856066,-32.98341727192565,-32.98375850280627,-32.98307908943784,-32.98319282202507,-32.98115455116416,-32.98160941789589,-32.97889164083113,-32.97934640962656,-32.97662854093828,-32.97708321180001,-32.97436525149733,-32.97481982442797,-32.97527431867615,-32.97571453494569,-32.97562959573495,-32.97564379501156,-32.97301064384504,-32.97346496148787,-32.97074677949452,-32.97120099921786,-32.96848272563632,-32.96893684744279,-32.96621848228221,-32.96667250617443,-32.96701297246565,-32.96633336145607,-32.96644683918352,-32.96440797542456,-32.96486182273712,-32.96214325520494,-32.96259700461172,-32.95987834552734,-32.96033199703098,-32.96055879328443,-32.95919942219855,-32.95942619397731,-32.95806680000671,-32.95840691358899,-32.95772720621883,-32.95784056637825,-32.95580141355071,-32.95622645683879,-32.95605652447384,-32.9560848581599,-32.95353583767479,-32.95398911683206,-32.95127007239078,-32.95194981479884,-32.95059025104866,-32.95081678771757,-32.94945720109171,-32.94991020582584,-32.94719095914294,-32.94764386599626,-32.94809669420494,-32.94537733679942,-32.94583006713319,-32.94628271882477,-32.94356325070869,-32.94401580453128,-32.94446827971414,-32.94174870089958,-32.94220107821938,-32.93948140794157,-32.94027284539199,-32.9395929081259,-32.939705949759,-32.9376661072708,-32.93800519187069,-32.93732523174236,-32.93743824891211,-32.93539833784079,-32.93585034295997,-32.93313037912284,-32.93358228639295,-32.93403411503806,-32.9344858650574,-32.93493753645024,-32.93629756582676,-32.93652337683972,-32.9378833929606,-32.93856072245507,-32.94128072931336,-32.94173220321094,-32.94445215699898,-32.94717203851027,-32.94989184773049,-32.95261158464525,-32.9553312492402,-32.958050841501,-32.96077036141328,-32.96348980896271,-32.96305229623605,-32.96313727722598,-32.9631231626643,-32.9657575377144,-32.96553168500173,-32.96689133108056,-32.96666545391162,-32.96802507710495,-32.97074426919226,-32.9734633888685,-32.97618243611934,-32.97663423778667,-32.9820721532143,-32.99294711427943,-32.99838415968782,-32.998836035562,-33.00155446852643,-33.00427282891311,-33.00665133470378,-33.00670782051155,-33.00704760281361,-33.00744297110852,-33.0078947467748,-33.01061300010634,-33.01106471610301,-33.0115163533597,-33.0128754718504,-33.01310126571483,-33.01446037080722,-33.01468614974861,-33.01513764857224,-33.01558906864969]},{"lng":[-71.55755855143371,-71.56052595439003,-71.56349333176956,-71.56349333176956,-71.56646068354841,-71.56646068354841,-71.56349333176956,-71.56349333176956,-71.56052595439003,-71.55755855143371,-71.55755855143371,-71.55755855143371,-71.55755855143371,-71.55755855143371],"lat":[-33.09303275051481,-33.09348537072389,-33.09393791207229,-33.09122195476021,-33.09167439831545,-33.08624222668312,-33.08578982100514,-33.08307364459056,-33.08262117901256,-33.0821686345898,-33.08488477310146,-33.08760083860233,-33.09031683107818,-33.09303275051481]}]]],null,"ae",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#6666ff","fillOpacity":0.6,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},"1",{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addHomeButton","args":[-71.70886299463996,-33.17221574576372,-71.42993636754706,-32.93313037912284,true,"ae","Zoom to ae","<strong> ae <\/strong>","bottomright"]},{"method":"addLayersControl","args":[["CartoDB.Positron","CartoDB.DarkMatter","OpenStreetMap","Esri.WorldImagery","OpenTopoMap"],"ae",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[-33.17221574576372,-32.93313037912284],"lng":[-71.70886299463996,-71.42993636754706]},"fitBounds":[-33.17221574576372,-71.70886299463996,-32.93313037912284,-71.42993636754706,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
<p>Trannsformar a formato soportado por google earth Engine</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ae_ee <span class="ot">&lt;-</span> ae <span class="sc">%&gt;%</span> <span class="fu">sf_as_ee</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lectura-de-producto-satelital" class="level3">
<h3 class="anchored" data-anchor-id="lectura-de-producto-satelital">Lectura de Producto Satelital</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>dataset <span class="ot">&lt;-</span>  ee<span class="sc">$</span><span class="fu">ImageCollection</span>(<span class="st">'NOAA/VIIRS/DNB/MONTHLY_V1/VCMSLCFG'</span>)<span class="sc">$</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filterDate</span>(<span class="st">'2020-01-01'</span>, <span class="st">'2020-12-01'</span>)<span class="sc">$</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">"avg_rad"</span>)<span class="sc">$</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">median</span>()</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>imagen <span class="ot">&lt;-</span> dataset<span class="sc">$</span><span class="fu">clip</span>(ae_ee)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>vis <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">min =</span> <span class="dv">0</span>, <span class="at">max =</span> <span class="dv">60</span>,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">palette =</span> <span class="fu">c</span>(<span class="st">'0602ff'</span>, <span class="st">'235cb1'</span>, <span class="st">'307ef3'</span>, <span class="st">'269db1'</span>, <span class="st">'30c8e2'</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'32d3ef'</span>, <span class="st">'3ae237'</span>,<span class="st">'b5e22e'</span>, <span class="st">'d6e21f'</span>, <span class="st">'fff705'</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'ffd611'</span>, <span class="st">'ffb613'</span>, <span class="st">'ff8b13'</span>, <span class="st">'ff6e08'</span>, <span class="st">'ff500d'</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'ff0000'</span>, <span class="st">'de0101'</span>, <span class="st">'c21301'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>region <span class="ot">&lt;-</span> ae_ee<span class="sc">$</span><span class="fu">bounds</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Visualización del producto satelital</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>Map<span class="sc">$</span><span class="fu">centerObject</span>(region, <span class="at">zoom =</span> <span class="dv">11</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>Map<span class="sc">$</span><span class="fu">addLayer</span>(imagen, vis, <span class="at">name =</span> <span class="st">"Nighttime"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="leaflet html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-22b158aa11e1003269cc" style="width:100%;height:464px;"></div>
<script type="application/json" data-for="htmlwidget-22b158aa11e1003269cc">{"x":{"options":{"minZoom":1,"maxZoom":24,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["CartoDB.Positron","CartoDB.Positron","CartoDB.Positron",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane","maxZoom":24}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane","maxZoom":24}]},{"method":"addProviderTiles","args":["CartoDB.DarkMatter","CartoDB.DarkMatter","CartoDB.DarkMatter",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane","maxZoom":24}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane","maxZoom":24}]},{"method":"addProviderTiles","args":["OpenTopoMap","OpenTopoMap","OpenTopoMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane","maxZoom":24}]},{"method":"addLayersControl","args":[["CartoDB.Positron","OpenStreetMap","CartoDB.DarkMatter","Esri.WorldImagery","OpenTopoMap"],[],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addTiles","args":["https://earthengine.googleapis.com/v1/projects/earthengine-legacy/maps/6cc99a0685ef09a72a3d0c4c1599d53a-a14b8175d0845f99807e81a7a7c31262/tiles/{z}/{x}/{y}","Nighttime","Nighttime",{"minZoom":0,"maxZoom":24,"tileSize":256,"subdomains":"abc","errorTileUrl":"","tms":false,"noWrap":false,"zoomOffset":0,"zoomReverse":false,"opacity":1,"zIndex":1,"detectRetina":false}]},{"method":"addLayersControl","args":[["CartoDB.Positron","OpenStreetMap","CartoDB.DarkMatter","Esri.WorldImagery","OpenTopoMap"],"Nighttime",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"hideGroup","args":[null]}],"setView":[[-33.05264562304892,-71.56939969999969],11,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
</div>
</section>
<section id="ln-ind" class="level3">
<h3 class="anchored" data-anchor-id="ln-ind">Cálculo de Indicador</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>mz_comuna <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/censo/manzanas.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NOM_COM <span class="sc">%in%</span> mis_comunas) <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DISTRITO =</span> <span class="fu">substr</span>(COD_ZON, <span class="dv">5</span>, <span class="dv">7</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">4326</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mapview(valpo_mz, zcol = "PERSONAS")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Es un proceso costoso computacionalmente, lo que toma un tiempo cercano a 3 minutos, es recomendable iterar por Distrito Censalcon objetivo si se cae la conexión con GEE en medio del cálculo, podriamos recomenzar eventualmente en el distrito censal donde se paro la instrucción.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>mz_lum <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(distrito <span class="cf">in</span> <span class="fu">unique</span>(mz_comuna<span class="sc">$</span>DISTRITO)){</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste0</span>(<span class="st">"Procesando DISTRITO censal "</span>, distrito))</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  mz_filtrada <span class="ot">&lt;-</span> mz_comuna <span class="sc">%&gt;%</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(DISTRITO <span class="sc">==</span> distrito)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculando  la luminosidad</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>  mz_luminocidad <span class="ot">&lt;-</span> <span class="fu">ee_extract</span>(<span class="at">x =</span> imagen, <span class="at">y =</span> mz_filtrada,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>                               <span class="at">sf =</span> T,<span class="at">scale =</span> <span class="dv">500</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>                               <span class="at">fun =</span>ee<span class="sc">$</span>Reducer<span class="sc">$</span><span class="fu">mean</span>())</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>  mz_lum <span class="ot">&lt;-</span> <span class="fu">rbind</span>(mz_lum, mz_luminocidad)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Guardar los resultados del objeto espacial generado en formato <code>rds</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">saveRDS</span>(mz_lum, <span class="st">"data/shape/luces_noc_gran_valpo.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># mapview::mapview(mz_lum, zcol = "avg_rad")</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># vislauzación cartografica</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>ind_LN <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span> </span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mz_lum, <span class="fu">aes</span>(<span class="at">fill =</span> avg_rad), <span class="at">color=</span><span class="cn">NA</span>) <span class="sc">+</span> </span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis</span>()<span class="sc">+</span> <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># xlab( "longitud") + ylab("latitud")+</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"ILN: Indicador de Luces Nocturnas"</span>, </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">"Utilizando Google Earth Engine"</span>,</span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>       <span class="at">fill =</span> <span class="st">"ILN"</span>)<span class="sc">+</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray94"</span>), </span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray94"</span>), </span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.9</span>)), </span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">hjust =</span> <span class="fl">0.5</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">"gray100"</span>),</span>
<span id="cb14-17"><a href="#cb14-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey20"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>)),</span>
<span id="cb14-18"><a href="#cb14-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text.y =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">"grey20"</span>, <span class="at">size =</span> <span class="fu">rel</span>(<span class="fl">0.7</span>))) </span>
<span id="cb14-19"><a href="#cb14-19" aria-hidden="true" tabindex="-1"></a>ind_LN</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="luces_nocturnas_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./espacial_r.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Objetos Espaciales en R</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./john_snow.html" class="pagination-link">
        <span class="nav-page-text">Mapa de Cólera</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Denis Berroeta</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>