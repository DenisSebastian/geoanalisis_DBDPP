<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.361">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Curso: Geoanálisis - 7&nbsp; Regresión Espacial</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./tarea_1.html" rel="next">
<link href="./autocorrelacion.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<link rel="stylesheet" href="styles/style.css">
</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./regresion_espacial.html"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regresión Espacial</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Curso: Geoanálisis</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Antecedentes</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro_estad_esp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Estadística Espacial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datos_espaciales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Datos Espaciales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./datos_vectoriales.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Datos Vectoriales</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./raster.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Datos tipo Raster</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./inferencia.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Inferencia Espacial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./autocorrelacion.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Autocorrelación Espacial</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./regresion_espacial.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regresión Espacial</span></span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Tareas</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tarea_1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tarea 1</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./tarea_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Tarea 2</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Anexos</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./espacial_r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Objetos Espaciales en R</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./luces_nocturnas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Luces Nocturnas con GEE</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./john_snow.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Mapa de Cólera</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#objetivos" id="toc-objetivos" class="nav-link active" data-scroll-target="#objetivos"><span class="header-section-number">7.1</span> Objetivos</a></li>
  <li><a href="#fundamentos-teóricos-de-regresión-espacial" id="toc-fundamentos-teóricos-de-regresión-espacial" class="nav-link" data-scroll-target="#fundamentos-teóricos-de-regresión-espacial"><span class="header-section-number">7.2</span> Fundamentos Teóricos de Regresión Espacial</a>
  <ul class="collapse">
  <li><a href="#introducción" id="toc-introducción" class="nav-link" data-scroll-target="#introducción"><span class="header-section-number">7.2.1</span> Introducción</a></li>
  <li><a href="#tipos-de-regresión" id="toc-tipos-de-regresión" class="nav-link" data-scroll-target="#tipos-de-regresión"><span class="header-section-number">7.2.2</span> Tipos de Regresión</a></li>
  </ul></li>
  <li><a href="#cálculo-de-regresión-espacial" id="toc-cálculo-de-regresión-espacial" class="nav-link" data-scroll-target="#cálculo-de-regresión-espacial"><span class="header-section-number">7.3</span> Cálculo de Regresión Espacial</a>
  <ul class="collapse">
  <li><a href="#pasos-de-regresion-espacial" id="toc-pasos-de-regresion-espacial" class="nav-link" data-scroll-target="#pasos-de-regresion-espacial"><span class="header-section-number">7.3.1</span> Pasos de Regresion Espacial</a></li>
  <li><a href="#selección-de-área-de-estudio" id="toc-selección-de-área-de-estudio" class="nav-link" data-scroll-target="#selección-de-área-de-estudio"><span class="header-section-number">7.3.2</span> Selección de Área de Estudio</a></li>
  <li><a href="#crear-matriz-de-vecindad" id="toc-crear-matriz-de-vecindad" class="nav-link" data-scroll-target="#crear-matriz-de-vecindad"><span class="header-section-number">7.3.3</span> Crear Matriz de Vecindad</a></li>
  <li><a href="#analizar-la-autorrelación-espacial-de-y" id="toc-analizar-la-autorrelación-espacial-de-y" class="nav-link" data-scroll-target="#analizar-la-autorrelación-espacial-de-y"><span class="header-section-number">7.3.4</span> Analizar la Autorrelación Espacial de <span class="math inline">y</span></a></li>
  <li><a href="#estimar-un-modelo-de-regresión-ordinario-ols" id="toc-estimar-un-modelo-de-regresión-ordinario-ols" class="nav-link" data-scroll-target="#estimar-un-modelo-de-regresión-ordinario-ols"><span class="header-section-number">7.3.5</span> Estimar un modelo de regresión ordinario (OLS)</a></li>
  <li><a href="#seleccionar-tipo-de-regresión-espacial" id="toc-seleccionar-tipo-de-regresión-espacial" class="nav-link" data-scroll-target="#seleccionar-tipo-de-regresión-espacial"><span class="header-section-number">7.3.6</span> Seleccionar tipo de Regresión Espacial</a></li>
  <li><a href="#modelo-de-error-espacial" id="toc-modelo-de-error-espacial" class="nav-link" data-scroll-target="#modelo-de-error-espacial"><span class="header-section-number">7.3.7</span> Modelo de error Espacial</a></li>
  <li><a href="#modelo-de-lag-espacial" id="toc-modelo-de-lag-espacial" class="nav-link" data-scroll-target="#modelo-de-lag-espacial"><span class="header-section-number">7.3.8</span> Modelo de Lag Espacial</a></li>
  </ul></li>
  <li><a href="#referencias-de-capítulo" id="toc-referencias-de-capítulo" class="nav-link" data-scroll-target="#referencias-de-capítulo"><span class="header-section-number">7.4</span> Referencias de Capítulo:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Regresión Espacial</span></h1>
<p class="subtitle lead">Modelos de Regresión Espacial con error y lag espacial</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="objetivos" class="level2 page-columns page-full" data-number="7.1">
<h2 data-number="7.1" class="anchored" data-anchor-id="objetivos"><span class="header-section-number">7.1</span> Objetivos</h2>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="images/m6_geoanalisis.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption margin-caption">Objetivos</figcaption>
</figure>
</div>
</section>
<section id="fundamentos-teóricos-de-regresión-espacial" class="level2 page-columns page-full" data-number="7.2">
<h2 data-number="7.2" class="anchored" data-anchor-id="fundamentos-teóricos-de-regresión-espacial"><span class="header-section-number">7.2</span> Fundamentos Teóricos de Regresión Espacial</h2>
<section id="introducción" class="level3" data-number="7.2.1">
<h3 data-number="7.2.1" class="anchored" data-anchor-id="introducción"><span class="header-section-number">7.2.1</span> Introducción</h3>
<p>El análisis de regresión le permite modelar, examinar y explorar relaciones espaciales y puede ayudar a explicar los factores detrás de los patrones espaciales observados. Sin embargo, hay una motivación adicional importante: incorporar explícitamente la dependencia espacial en el modelo. Hay dos tipos comunes de regresión espacial: el modelo de error espacial (SEM) y el modelo de retraso espacial (SLM).</p>
</section>
<section id="tipos-de-regresión" class="level3 page-columns page-full" data-number="7.2.2">
<h3 data-number="7.2.2" class="anchored" data-anchor-id="tipos-de-regresión"><span class="header-section-number">7.2.2</span> Tipos de Regresión</h3>
<p><strong>Modelo de error espacial: </strong></p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="images/m_error.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption margin-caption">Explicación Modelo de Error Espacial</figcaption>
</figure>
</div>
<p>La principal razón para aplicar un modelo de error espacial es controlar la autocorrelación espacial general. Queremos hacerlo porque la autocorrelación espacial rompe el importante supuesto de que nuestros errores de regresión no están correlacionados.</p>
<p><strong>Modelo de retraso (lag) espacial:</strong></p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="images/m_lag.png" class="img-fluid figure-img" style="width:60.0%"></p>
<figcaption class="figure-caption margin-caption">Explicación Modelo de lag Espacial</figcaption>
</figure>
</div>
<p>La principal razón para ejecutar un modelo de retraso espacial es modelar formalmente el contagio espacial. Estamos modelando el impacto de los resultados de nuestros vecinos en nuestro propio resultado.</p>
</section>
</section>
<section id="cálculo-de-regresión-espacial" class="level2 page-columns page-full" data-number="7.3">
<h2 data-number="7.3" class="anchored" data-anchor-id="cálculo-de-regresión-espacial"><span class="header-section-number">7.3</span> Cálculo de Regresión Espacial</h2>
<p>A continuación se realizarán dos modelos de regresión espacial, el primero con error espacial y la variable a explicar es el nivel socioecómico. En segundo caso la variable a explicar será el indicador de delitos violentos en la comuna de Las Condes, y se aplicará modelo error y lag espacial, además del un modelo que combina ambos llamado <code>sacsar</code>.</p>
<section id="pasos-de-regresion-espacial" class="level3" data-number="7.3.1">
<h3 data-number="7.3.1" class="anchored" data-anchor-id="pasos-de-regresion-espacial"><span class="header-section-number">7.3.1</span> Pasos de Regresion Espacial</h3>
<ol start="0" type="1">
<li>Selección de Área de Estudio</li>
<li>Crear Matriz de Vecindad</li>
<li>Analizar la Autorrelación Espacial de <span class="math inline">y</span></li>
<li>Estimar un modelo de regresión ordinario (OLS)</li>
<li>Seleccionar tipo de Regresión Espacial</li>
<li>Estimar Modelo de Regresión Espacial</li>
</ol>
</section>
<section id="selección-de-área-de-estudio" class="level3" data-number="7.3.2">
<h3 data-number="7.3.2" class="anchored" data-anchor-id="selección-de-área-de-estudio"><span class="header-section-number">7.3.2</span> Selección de Área de Estudio</h3>
<p><strong>Cargar Librerías</strong></p>
<div class="cell">

</div>
<p><strong>Selección de Área de Estudio</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>mi_comuna <span class="ot">&lt;-</span>  <span class="st">"LAS CONDES"</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ine</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mz_comuna <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/censo/manzanas.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NOM_COM <span class="sc">==</span> mi_comuna) <span class="sc">%&gt;%</span> </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32719</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># socioeconomicos</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>soc <span class="ot">&lt;-</span>  <span class="fu">st_read</span>(<span class="st">"data/socioeconomicos/resultados/R13_ind_socioeconomicos.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_MANZ, ID_MANZCIT, IEJ, IEM, IPJ, IRH, IVI, ISV) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `R13_ind_socioeconomicos' from data source 
  `/Users/denisberroeta/Library/CloudStorage/OneDrive-UniversidadAdolfoIbanez/Goblab/BDPP_Geoanalisis/geoanalisis_book/data/socioeconomicos/resultados/R13_ind_socioeconomicos.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 55754 features and 20 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 249067.9 ymin: 6205212 xmax: 428360.8 ymax: 6356031
Projected CRS: WGS 84 / UTM zone 19S</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>mz_comuna <span class="ot">&lt;-</span>  mz_comuna <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CODINE017 =</span> <span class="fu">as.character</span>(CODINE017)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(soc,<span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CODINE017"</span> <span class="ot">=</span> <span class="st">"ID_MANZ"</span>))</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="co"># head(mz_comuna)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Agregar Variable de Densidad Poblacional</strong></p>
<p>Calcula la densidad poblacional por hetárea</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>mz_comuna <span class="ot">&lt;-</span> mz_comuna <span class="sc">%&gt;%</span> </span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">densidad_hec =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(POBLACION<span class="sc">/</span>(<span class="fu">st_area</span>(.)<span class="sc">/</span><span class="dv">10000</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Eliminar Valores Nulos</strong></p>
<p>Primero se cfrea una variable que se prentende explicar</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>mz_comuna <span class="ot">&lt;-</span>  mz_comuna <span class="sc">%&gt;%</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">nived =</span> JH_ESC_P) <span class="sc">%&gt;%</span> <span class="co"># Usaremos variable auxiliar de nivel educacional</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(nived))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mz_comuna, <span class="fu">aes</span>(<span class="at">fill =</span> nived), <span class="at">color =</span><span class="st">"gray80"</span>, </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>          <span class="at">alpha=</span><span class="dv">1</span>,  <span class="at">size=</span> <span class="fl">0.1</span>)<span class="sc">+</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_distiller</span>(<span class="at">palette=</span> <span class="st">"YlGnBu"</span>, <span class="at">direction =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Nivel Educacional del Jefe de Hogar"</span>) <span class="sc">+</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))<span class="sc">+</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>), </span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="crear-matriz-de-vecindad" class="level3" data-number="7.3.3">
<h3 data-number="7.3.3" class="anchored" data-anchor-id="crear-matriz-de-vecindad"><span class="header-section-number">7.3.3</span> Crear Matriz de Vecindad</h3>
<p>Definir un criterio de vecidad, para el caso de estudio es la distancia y asignar pesos espciales</p>
<p><strong>Polígonos a puntos</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>ptos_comuna <span class="ot">&lt;-</span> mz_comuna<span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Calcular Vecinos Cercanos (<span class="math inline">k</span>)</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># vecinos mas cercanos (neighbours)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">8</span> <span class="co"># numero de vecinos a buscar</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>nb_mzs <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(ptos_comuna, <span class="at">k =</span> k) <span class="sc">%&gt;%</span>  <span class="co"># por punto calcula K vecinos</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knn2nb</span>() <span class="co"># Knn a matriz de vecindad</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Visualización de la relaciones por cada Centroide</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># matri&lt; de vecindad a lines solo oara visualizaciñon</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>neighbors_sf <span class="ot">&lt;-</span> <span class="fu">as</span>(<span class="fu">nb2lines</span>(nb_mzs, <span class="at">coords =</span> <span class="fu">st_geometry</span>(ptos_comuna)), <span class="st">'sf'</span>)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>p_mv <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> mz_comuna, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span><span class="st">"gray60"</span>, <span class="at">alpha=</span><span class="dv">1</span>,  <span class="at">size=</span> <span class="fl">0.3</span>)<span class="sc">+</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> neighbors_sf,  <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">alpha=</span><span class="fl">0.5</span>,  <span class="at">size=</span> <span class="fl">0.5</span>)<span class="sc">+</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> ptos_comuna,  <span class="at">color =</span><span class="st">"#525252"</span>, <span class="at">alpha=</span><span class="dv">1</span>,  <span class="at">size=</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">"Relaciones de Vecindad por cada manzana (k = 8)"</span>) <span class="sc">+</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">12</span>))<span class="sc">+</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>), </span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">"gray80"</span>))</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>p_mv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Asignar Pesos Espaciales por población</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span><span class="fu">nb2listw</span>(nb_mzs)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>mz_comuna<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mz_comuna)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>nb<span class="sc">$</span>weights <span class="ot">=</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mz_comuna), <span class="cf">function</span>(i)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  mz_comuna<span class="sc">$</span>POBLACION[mz_comuna<span class="sc">$</span>id <span class="sc">%in%</span> nb<span class="sc">$</span>neighbours[[i]]] <span class="sc">/</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(mz_comuna<span class="sc">$</span>POBLACION[mz_comuna<span class="sc">$</span>id <span class="sc">%in%</span> nb<span class="sc">$</span>neighbours[[i]]]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="analizar-la-autorrelación-espacial-de-y" class="level3" data-number="7.3.4">
<h3 data-number="7.3.4" class="anchored" data-anchor-id="analizar-la-autorrelación-espacial-de-y"><span class="header-section-number">7.3.4</span> Analizar la Autorrelación Espacial de <span class="math inline">y</span></h3>
<p>A través del test estadítico índice de Moran analizar la autocorrelación espacial de la variable dependiente que se pretende explicar.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Test de Moran</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(mz_comuna<span class="sc">$</span>nived,<span class="at">listw=</span>nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mz_comuna$nived  
weights: nb    

Moran I statistic standard deviate = 54.42, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.7884021415     -0.0006635700      0.0002102337 </code></pre>
</div>
</div>
</section>
<section id="estimar-un-modelo-de-regresión-ordinario-ols" class="level3 page-columns page-full" data-number="7.3.5">
<h3 data-number="7.3.5" class="anchored" data-anchor-id="estimar-un-modelo-de-regresión-ordinario-ols"><span class="header-section-number">7.3.5</span> Estimar un modelo de regresión ordinario (OLS)</h3>
<p><strong>Transformación de Variables</strong></p>
<p>Revisión de la distribución de Variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(mz_comuna<span class="sc">$</span>densidad_hec, <span class="at">breaks=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(<span class="fu">log</span>(mz_comuna<span class="sc">$</span>densidad_hec), <span class="at">breaks=</span><span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"nived"</span>,<span class="st">"densidad_hec"</span>,<span class="st">"ISV"</span>,<span class="st">"IVI"</span>,<span class="st">"IRH"</span>, <span class="st">"IEM"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Ciclo para graficos agrupados</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> colnames) {</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(mz_comuna <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span>v), <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">main=</span>v, <span class="at">probability=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Transformaciones de Datos en modelos</strong></p>
<p>Se pueden transformar los datos para obtener mejor linealidad entre sus relaciones entre las variables respuesta y predictivas. Las transformaciones más utilizadas son:</p>
<ul>
<li><code>log(y)</code> frente a x para relaciones exponenciales</li>
<li><code>log(y)</code> contra log(x) para funciones de potencia;</li>
<li><code>exp(y)</code> contra x para relaciones logarítmicas;</li>
<li><code>1/y</code> contra <code>1/x</code> para las relaciones asintóticas;</li>
<li><code>log(p/(1 - p))</code> contra x para datos de proporción.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>mz_comuna <span class="ot">&lt;-</span> mz_comuna <span class="sc">%&gt;%</span> </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">l_nived =</span> nived<span class="sc">^</span><span class="dv">3</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">l_densidad_hec =</span> <span class="fu">log</span>(densidad_hec),</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">l_ISV =</span> <span class="fu">log</span>(ISV),</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">l_IVI =</span> <span class="fu">log</span>(IVI),</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">l_IRH =</span> <span class="fu">log</span>(IRH),</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">l_IEM =</span> <span class="fu">log</span>(IEM)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"l_nived"</span>,<span class="st">"l_densidad_hec"</span>,<span class="st">"l_ISV"</span>,<span class="st">"l_IVI"</span>,<span class="st">"l_IRH"</span>, <span class="st">"l_IEM"</span>)</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ciclo para graficos agrupados</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>com <span class="ot">&lt;-</span> mz_comuna <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() </span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> colnames) {</span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(com <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span>v), <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">main=</span>v, <span class="at">probability=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p><strong>Modelo OLS</strong></p>
<p>Modelo estadístico que relaciona funcionalmente dos variables de forma lineal (una recta o, en su versión generalizada, un plano o un hiperplano). El caso más simple contiene una variable respuesta (Y; i.e.&nbsp;lo que se quiere explicar o predecir), y una variable explicativa o predictor (X; i.e., variables que se usan para explicar o predecir Y). A veces estas variables también son llamadas dependiente e independiente.</p>
<p>Que exista una relación funcional significativa entre ambas variables no implica una causalidad, <del>pero la puede sugerir</del>.</p>
<p><span class="math display">y = b_0 + b_1*x_1 + b-_2*x_2 + b_3*x_3 + … + b_n*x_n+\varepsilon</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>mod_nived <span class="ot">=</span> <span class="fu">lm</span>(l_nived <span class="sc">~</span> l_densidad_hec <span class="sc">+</span> l_ISV <span class="sc">+</span> l_IVI <span class="sc">+</span> l_IRH <span class="sc">+</span> l_IEM,</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mz_comuna)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_nived)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = l_nived ~ l_densidad_hec + l_ISV + l_IVI + l_IRH + 
    l_IEM, data = mz_comuna)

Residuals:
    Min      1Q  Median      3Q     Max 
-4019.5  -400.6   156.5   669.5  4062.1 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)     5151.28     151.42  34.020  &lt; 2e-16 ***
l_densidad_hec  -184.79      33.92  -5.448 5.94e-08 ***
l_ISV          21437.26    3120.22   6.870 9.35e-12 ***
l_IVI           9103.21     794.40  11.459  &lt; 2e-16 ***
l_IRH            899.25     270.00   3.331 0.000888 ***
l_IEM           5105.64     779.96   6.546 8.09e-11 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 1012 on 1502 degrees of freedom
Multiple R-squared:  0.2021,    Adjusted R-squared:  0.1995 
F-statistic:  76.1 on 5 and 1502 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot(mod_nived)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Output Modelo de Regresión</strong></p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="images/output_model.png" class="img-fluid figure-img"></p>
<figcaption class="figure-caption margin-caption">Output de modelos de regesión</figcaption>
</figure>
</div>
<p><strong>P - Valor</strong> <span class="math inline">p-value</span></p>
<p><span class="math inline">p-value</span> Probabilidad de que el la H0 sea verdad. P-valores significativos, ej., bajo alpha = 0.05, lleva a interpretar la probabilidad de que el modelo de regresión no explique una porción significativa de la varianza de Y es baja.</p>
<ul>
<li><span class="math inline">H_0</span>: El modelo NO explica la varianza de los datos Y</li>
<li><span class="math inline">H_1</span>: El modelo SI explica la varianza de los datos Y</li>
</ul>
<p><strong>Coeficiente de determinación (<span class="math inline">R^2</span>)</strong></p>
<p>El coeficiente de determinación (o el cuadrado de la correlación de Pearson) es una de las métricas más utilizadas. Si bien esta es muy útil, pueden haber ocasiones donde valores altos de R² se obtienen cuando la dispersión o error de las predicciones es alta. Los valores van entre 0 y 1. Es una medida de ajuste relativa (porcentual), por lo que puede ser usada para comparar modelos entre sí.</p>
<p><strong>Distribución F de Fisher</strong></p>
<p>Comparar si hay diferencias significativas entre dos varianzas. En caso de las regresiones proporciona esencialmente una medida de la cantidad de variación que explica el modelo frente a la cantidad de variación no explicada (por grados de libertad restantes).</p>
<p>Valores de <span class="math inline">F</span> altos significa que su modelo explica mucho más de la variación por parámetro que el error por grado de libertad restante.</p>
<p><strong>Residuos</strong></p>
<p>Los residuos son la diferencia entre los valores observados y los predichos (obs - pred). Los residuos se utilizan mucho en post-hoc tests (o tests para analizar los resultados de los modelos). Los residuos, por un lado, dan estimaciones de posibles sesgos del modelo.</p>
<p>Es muy importante que los residuos se distribuyan de manera aleatoria en el modelo.</p>
<div class="quarto-figure quarto-figure-center page-columns page-full">
<figure class="figure page-columns page-full">
<p><img src="images/plot_residuos.png" class="img-fluid figure-img" width="300"></p>
<figcaption class="figure-caption margin-caption">Visualización de los residuos</figcaption>
</figure>
</div>
<p><strong>Análisis de Residuos</strong></p>
<p>Para verificar que la relación a estudiar no genera residuos que se encuentren correlacionados espacialmente, extraemos los errores del modelo OLS y aplicamos el contraste de hipótesis usual, usando el estadístico de Moran (ó Moran’s I):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>residuals_mod_nived<span class="ot">&lt;-</span><span class="fu">residuals</span>(mod_nived)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(residuals_mod_nived, <span class="at">listw =</span> nb,  <span class="at">randomisation =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  residuals_mod_nived  
weights: nb    

Moran I statistic standard deviate = 37.878, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.5491099106     -0.0006635700      0.0002106614 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>moran_res <span class="ot">&lt;-</span><span class="fu">moran.mc</span>(residuals_mod_nived, nb, <span class="at">nsim=</span><span class="dv">599</span>)</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(moran_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="seleccionar-tipo-de-regresión-espacial" class="level3" data-number="7.3.6">
<h3 data-number="7.3.6" class="anchored" data-anchor-id="seleccionar-tipo-de-regresión-espacial"><span class="header-section-number">7.3.6</span> Seleccionar tipo de Regresión Espacial</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Test Moran residuos</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.morantest</span>(mod_nived,nb,<span class="at">alternative=</span><span class="st">"greater"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Global Moran I for regression residuals

data:  
model: lm(formula = l_nived ~ l_densidad_hec + l_ISV + l_IVI + l_IRH +
l_IEM, data = mz_comuna)
weights: nb

Moran I statistic standard deviate = 38.006, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Observed Moran I      Expectation         Variance 
    0.5491099106    -0.0013513898     0.0002097729 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Tipo de dependencia</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">lm.LMtests</span>(mod_nived,nb,<span class="at">test=</span><span class="st">"all"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = l_nived ~ l_densidad_hec + l_ISV + l_IVI + l_IRH +
l_IEM, data = mz_comuna)
weights: nb

LMerr = 1422.7, df = 1, p-value &lt; 2.2e-16


    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = l_nived ~ l_densidad_hec + l_ISV + l_IVI + l_IRH +
l_IEM, data = mz_comuna)
weights: nb

LMlag = 1791.5, df = 1, p-value &lt; 2.2e-16


    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = l_nived ~ l_densidad_hec + l_ISV + l_IVI + l_IRH +
l_IEM, data = mz_comuna)
weights: nb

RLMerr = 0.47975, df = 1, p-value = 0.4885


    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = l_nived ~ l_densidad_hec + l_ISV + l_IVI + l_IRH +
l_IEM, data = mz_comuna)
weights: nb

RLMlag = 369.26, df = 1, p-value &lt; 2.2e-16


    Lagrange multiplier diagnostics for spatial dependence

data:  
model: lm(formula = l_nived ~ l_densidad_hec + l_ISV + l_IVI + l_IRH +
l_IEM, data = mz_comuna)
weights: nb

SARMA = 1791.9, df = 2, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
</section>
<section id="modelo-de-error-espacial" class="level3" data-number="7.3.7">
<h3 data-number="7.3.7" class="anchored" data-anchor-id="modelo-de-error-espacial"><span class="header-section-number">7.3.7</span> Modelo de error Espacial</h3>
<p>A pesar de que nuestro modelo goza de las características ideales asociadas a un modelo de regresión líneal estándar, hemos comprobado que los residuos de la regresión presentan autocorrelación espacial. Por tanto, para reconocer la existencia de esta estructura espacial en los errores, usamos el Modelo del Error Espacial. Este modelo se define como:</p>
<p><span class="math display">y=\beta_0+X\beta+\varepsilon</span></p>
<p><span class="math display">\varepsilon= \lambda W \varepsilon+ \xi</span></p>
<p>Donde <span class="math inline">X</span> son las variables predictoras, mientras que <span class="math inline">W</span> es la matriz de peso espacial. El parámetro <span class="math inline">\lambda</span> es el indicador que mide la fuerza espacial de los residuos y los residuos de los vecinos.</p>
<p>En R, estimamos el modelo vía Maximum Likelihood (máxima verosimilitud) de la siguiente forma:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="do">## SDEM Spatial Durbin Error Model</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>fit.err <span class="ot">=</span> spatialreg<span class="sc">::</span><span class="fu">errorsarlm</span>(</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  l_nived <span class="sc">~</span> l_densidad_hec <span class="sc">+</span> l_ISV <span class="sc">+</span> l_IVI <span class="sc">+</span> l_IRH <span class="sc">+</span> l_IEM,</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> mz_comuna,</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">listw =</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nb_mzs),</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">etype =</span> <span class="st">"error"</span>,</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">method =</span> <span class="st">"eigen"</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># saveRDS(fit.err, "data/models/fit.err_nived.rds")</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>fit.err <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/models/fit.err_nived.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.err, <span class="at">Nagelkerke=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:spatialreg::errorsarlm(formula = l_nived ~ l_densidad_hec + l_ISV + 
    l_IVI + l_IRH + l_IEM, data = mz_comuna, listw = spdep::nb2listw(nb_mzs), 
    etype = "error", method = "eigen")

Residuals:
       Min         1Q     Median         3Q        Max 
-4017.0145  -355.0942     4.1932   358.5864  2618.4853 

Type: error 
Coefficients: (asymptotic standard errors) 
               Estimate Std. Error z value  Pr(&gt;|z|)
(Intercept)    3871.718    149.503 25.8972 &lt; 2.2e-16
l_densidad_hec   45.085     24.008  1.8779 0.0603881
l_ISV          2399.207   2113.385  1.1352 0.2562731
l_IVI          1617.466    472.923  3.4201 0.0006259
l_IRH           657.582    159.916  4.1120 3.922e-05
l_IEM           785.253    462.932  1.6963 0.0898370

Lambda: 0.85764, LR test value: 1349.6, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.014983
    z-value: 57.241, p-value: &lt; 2.22e-16
Wald statistic: 3276.5, p-value: &lt; 2.22e-16

Log likelihood: -11897.29 for error model
ML residual variance (sigma squared): 363320, (sigma: 602.76)
Nagelkerke pseudo-R-squared: 0.67397 
Number of observations: 1508 
Number of parameters estimated: 8 
AIC: 23811, (AIC for lm: 25158)</code></pre>
</div>
</div>
<p>En este modelo, las variables <code>l_densidad_hec</code>, <code>l_ISV</code> dejaron de ser significativa. Mientras que <span class="math inline">\lambda</span> nos indica que el modelo tiene una fuerte correlación espacial en los residuos.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Test Moran residuos</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>res.err<span class="ot">=</span>fit.err<span class="sc">$</span>residuals</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(res.err,nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  res.err  
weights: nb    

Moran I statistic standard deviate = -2.1177, p-value = 0.9829
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
    -0.0313896508     -0.0006635700      0.0002105203 </code></pre>
</div>
</div>
</section>
<section id="modelo-de-lag-espacial" class="level3" data-number="7.3.8">
<h3 data-number="7.3.8" class="anchored" data-anchor-id="modelo-de-lag-espacial"><span class="header-section-number">7.3.8</span> Modelo de Lag Espacial</h3>
<p><strong>Consolidar Base Inicial</strong></p>
<p>INE</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>mi_comuna <span class="ot">&lt;-</span>  <span class="st">"LAS CONDES"</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ine</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>mz_comuna <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/censo/manzanas.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(NOM_COM <span class="sc">==</span> mi_comuna) <span class="sc">%&gt;%</span> </span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32719</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>socioeconomicos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>soc <span class="ot">&lt;-</span>  <span class="fu">st_read</span>(<span class="st">"data/socioeconomicos/resultados/R13_ind_socioeconomicos.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(ID_MANZ, ID_MANZCIT, IEJ, IEM, IPJ, IRH, IVI, ISV)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `R13_ind_socioeconomicos' from data source 
  `/Users/denisberroeta/Library/CloudStorage/OneDrive-UniversidadAdolfoIbanez/Goblab/BDPP_Geoanalisis/geoanalisis_book/data/socioeconomicos/resultados/R13_ind_socioeconomicos.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 55754 features and 20 fields
Geometry type: POLYGON
Dimension:     XY
Bounding box:  xmin: 249067.9 ymin: 6205212 xmax: 428360.8 ymax: 6356031
Projected CRS: WGS 84 / UTM zone 19S</code></pre>
</div>
</div>
<p>Sii</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>sii <span class="ot">&lt;-</span>  <span class="fu">st_read</span>(<span class="st">"data/sii/urbes.shp"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(n_com <span class="sc">==</span> mi_comuna) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_set_crs</span>(<span class="dv">4326</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="dv">32719</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `urbes' from data source 
  `/Users/denisberroeta/Library/CloudStorage/OneDrive-UniversidadAdolfoIbanez/Goblab/BDPP_Geoanalisis/geoanalisis_book/data/sii/urbes.shp' 
  using driver `ESRI Shapefile'
Simple feature collection with 210662 features and 11 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: -75.72058 ymin: -54.48149 xmax: -68.02319 ymax: -17.98338
Geodetic CRS:  GCS_unknown</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>sii_com <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(sii, mz_comuna <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">select</span>(CODINE017)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(CODINE017,oficinas<span class="sc">:</span> atractor) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CODINE017 =</span> <span class="fu">as.character</span>(CODINE017)) <span class="sc">%&gt;%</span> </span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a><span class="co"># mapview(sii, zcol ="atractor", cex=2)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>delitos</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>idel_violentos_LC <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"data/delitos/idel_violentos_LC.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(CODINE017, idelv) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CODINE017 =</span> <span class="fu">as.character</span>(CODINE017)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Consolidación</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>mz_estudio <span class="ot">&lt;-</span>  mz_comuna <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CODINE017 =</span> <span class="fu">as.character</span>(CODINE017)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(soc,<span class="at">by =</span> <span class="fu">c</span>(<span class="st">"CODINE017"</span> <span class="ot">=</span> <span class="st">"ID_MANZ"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sii_com,<span class="at">by =</span> <span class="st">"CODINE017"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(idel_violentos_LC,<span class="at">by =</span> <span class="st">"CODINE017"</span>) <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Selección de variables</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>mz_estudio <span class="ot">&lt;-</span> mz_estudio<span class="sc">%&gt;%</span> </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(CODINE017, POBLACION, IEJ,IEM,IPJ, IRH, IVI, ISV,</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>                vivienda, atractor,idelv) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">densidad_hec =</span> <span class="fu">round</span>(<span class="fu">as.numeric</span>(POBLACION<span class="sc">/</span>(<span class="fu">st_area</span>(.)<span class="sc">/</span><span class="dv">10000</span>))))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="transformaciones" class="level4" data-number="7.3.8.1">
<h4 data-number="7.3.8.1" class="anchored" data-anchor-id="transformaciones"><span class="header-section-number">7.3.8.1</span> Transformaciones</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"idelv"</span>, <span class="st">"IEJ"</span>,<span class="st">"IEM"</span>,<span class="st">"IPJ"</span>, <span class="st">"IRH"</span>, <span class="st">"IVI"</span>, <span class="st">"ISV"</span>,</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>                <span class="st">"vivienda"</span>, <span class="st">"atractor"</span>,<span class="st">"densidad_hec"</span>)</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Ciclo para graficos agrupados</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> colnames) {</span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(mz_estudio <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span>v), <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">main=</span>v, <span class="at">probability=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>mz_estudio <span class="ot">&lt;-</span> mz_estudio <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">rc_idelv =</span> idelv<span class="sc">^</span>(<span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>),</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">c_IEJ =</span> IEJ <span class="sc">**</span><span class="dv">3</span>,</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">c_IEM =</span> IEM <span class="sc">**</span><span class="dv">3</span>,</span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">c_IPJ =</span> IPJ <span class="sc">**</span><span class="dv">3</span>,</span>
<span id="cb46-7"><a href="#cb46-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">c_IRH =</span> IRH <span class="sc">**</span><span class="dv">3</span>,</span>
<span id="cb46-8"><a href="#cb46-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">l_vivienda=</span> <span class="fu">log</span>(<span class="fu">ifelse</span>(vivienda<span class="sc">==</span><span class="dv">0</span>, <span class="fl">0.001</span>, vivienda)),</span>
<span id="cb46-9"><a href="#cb46-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">l_atractor=</span> <span class="fu">log</span>(<span class="fu">ifelse</span>(atractor<span class="sc">==</span><span class="dv">0</span>, <span class="fl">0.001</span>, atractor)),</span>
<span id="cb46-10"><a href="#cb46-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">densidad_hec=</span> <span class="fu">log</span>(<span class="fu">ifelse</span>(densidad_hec<span class="sc">==</span><span class="dv">0</span>, <span class="fl">0.001</span>, densidad_hec))</span>
<span id="cb46-11"><a href="#cb46-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>colnames <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"rc_idelv"</span>,<span class="st">"c_IEJ"</span>,<span class="st">"c_IEM"</span>,<span class="st">"c_IPJ"</span>,<span class="st">"c_IRH"</span>, </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>              <span class="st">"l_vivienda"</span>, <span class="st">"l_atractor"</span>, <span class="st">"densidad_hec"</span>)</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Ciclo para graficos agrupados</span></span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (v <span class="cf">in</span> colnames) {</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">hist</span>(mz_estudio <span class="sc">%&gt;%</span> <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> <span class="fu">pull</span>(<span class="sc">!!</span>v), <span class="at">breaks=</span><span class="dv">100</span>, <span class="at">main=</span>v, <span class="at">probability=</span><span class="cn">TRUE</span>, <span class="at">col=</span><span class="st">"gray"</span>)</span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="regresion_espacial_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Modelo OLS</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>mod_idelv <span class="ot">=</span> <span class="fu">lm</span>(rc_idelv <span class="sc">~</span> c_IEJ <span class="sc">+</span> c_IEM <span class="sc">+</span> c_IPJ <span class="sc">+</span> c_IRH<span class="sc">+</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>               IVI<span class="sc">+</span> ISV<span class="sc">+</span>l_vivienda<span class="sc">+</span>l_atractor<span class="sc">+</span>densidad_hec, </span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mz_estudio)</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_idelv)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = rc_idelv ~ c_IEJ + c_IEM + c_IPJ + c_IRH + IVI + 
    ISV + l_vivienda + l_atractor + densidad_hec, data = mz_estudio)

Residuals:
     Min       1Q   Median       3Q      Max 
-2.40034 -0.39452  0.01851  0.42548  2.29776 

Coefficients:
               Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)   7.760e+00  1.163e+00   6.674 3.11e-11 ***
c_IEJ        -4.257e-04  1.496e-05 -28.453  &lt; 2e-16 ***
c_IEM        -3.587e-01  1.893e-01  -1.895  0.05818 .  
c_IPJ        -3.641e-01  8.328e-02  -4.372 1.29e-05 ***
c_IRH         8.847e-01  8.526e-02  10.377  &lt; 2e-16 ***
IVI           1.340e+00  4.486e-01   2.986  0.00286 ** 
ISV          -5.726e+00  1.060e+00  -5.399 7.39e-08 ***
l_vivienda   -1.216e-02  2.814e-03  -4.321 1.62e-05 ***
l_atractor    3.604e-02  1.934e-03  18.634  &lt; 2e-16 ***
densidad_hec  4.177e-01  1.746e-02  23.923  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6542 on 2265 degrees of freedom
Multiple R-squared:  0.5603,    Adjusted R-squared:  0.5585 
F-statistic: 320.7 on 9 and 2265 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>residuals_idelv <span class="ot">&lt;-</span><span class="fu">residuals</span>(mod_idelv)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(residuals_idelv, <span class="at">listw =</span> spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nb_mzs),  <span class="at">randomisation =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="autocorrelación-espacial" class="level4" data-number="7.3.8.2">
<h4 data-number="7.3.8.2" class="anchored" data-anchor-id="autocorrelación-espacial"><span class="header-section-number">7.3.8.2</span> Autocorrelación Espacial</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>ptos_comuna <span class="ot">&lt;-</span> mz_estudio<span class="sc">%&gt;%</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_centroid</span>()</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="co"># vecinos mas cercanos (neighbours)</span></span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>k <span class="ot">&lt;-</span> <span class="dv">8</span> <span class="co"># numero de vecinos a buscar</span></span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>nb_mzs <span class="ot">&lt;-</span> <span class="fu">knearneigh</span>(ptos_comuna, <span class="at">k =</span> k) <span class="sc">%&gt;%</span>  <span class="co"># por punto calcula K vecinos</span></span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">knn2nb</span>() <span class="co"># Knn a matriz de vecindad</span></span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>nb <span class="ot">&lt;-</span><span class="fu">nb2listw</span>(nb_mzs)</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a>mz_estudio<span class="sc">$</span>id <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mz_estudio)</span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a>nb<span class="sc">$</span>weights <span class="ot">=</span> <span class="fu">lapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(mz_estudio), <span class="cf">function</span>(i)</span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  mz_estudio<span class="sc">$</span>POBLACION[mz_estudio<span class="sc">$</span>id <span class="sc">%in%</span> nb<span class="sc">$</span>neighbours[[i]]] <span class="sc">/</span> </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sum</span>(mz_estudio<span class="sc">$</span>POBLACION[mz_estudio<span class="sc">$</span>id <span class="sc">%in%</span> nb<span class="sc">$</span>neighbours[[i]]]))</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Test de Moran</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(mz_estudio<span class="sc">$</span>rc_idelv,<span class="at">listw=</span>nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  mz_estudio$rc_idelv  
weights: nb    

Moran I statistic standard deviate = 85.276, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.9486463950     -0.0004397537      0.0001238681 </code></pre>
</div>
</div>
<p>Error espacial</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="do">## SDEM Spatial Durbin Error Model</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>fit.errdurb_del<span class="ot">=</span><span class="fu">errorsarlm</span>(rc_idelv <span class="sc">~</span> c_IEJ <span class="sc">+</span> c_IEM <span class="sc">+</span> c_IPJ <span class="sc">+</span> c_IRH<span class="sc">+</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>               IVI<span class="sc">+</span> ISV<span class="sc">+</span>l_vivienda<span class="sc">+</span>l_atractor<span class="sc">+</span>densidad_hec, </span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mz_estudio,</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">listw=</span>spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nb_mzs),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">etype=</span><span class="st">"error"</span>,<span class="at">method=</span><span class="st">"eigen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.errdurb_del, <span class="at">Nagelkerke=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:errorsarlm(formula = rc_idelv ~ c_IEJ + c_IEM + c_IPJ + c_IRH + 
    IVI + ISV + l_vivienda + l_atractor + densidad_hec, data = mz_estudio, 
    listw = spdep::nb2listw(nb_mzs), etype = "error", method = "eigen")

Residuals:
      Min        1Q    Median        3Q       Max 
-2.137774 -0.086091  0.010694  0.093117  0.703214 

Type: error 
Coefficients: (asymptotic standard errors) 
                Estimate  Std. Error z value  Pr(&gt;|z|)
(Intercept)   4.7399e+00  7.0494e-01  6.7238 1.770e-11
c_IEJ        -2.4073e-05  9.0324e-06 -2.6652  0.007695
c_IEM        -2.3783e-02  6.2797e-02 -0.3787  0.704889
c_IPJ        -1.4801e-02  3.0862e-02 -0.4796  0.631528
c_IRH        -2.4129e-02  3.2158e-02 -0.7503  0.453051
IVI           9.2301e-03  1.6717e-01  0.0552  0.955967
ISV          -1.6196e+00  6.7003e-01 -2.4171  0.015643
l_vivienda   -1.0158e-03  9.0700e-04 -1.1200  0.262729
l_atractor    1.3705e-03  7.8268e-04  1.7510  0.079946
densidad_hec  4.0797e-02  8.1071e-03  5.0322 4.849e-07

Lambda: 0.96574, LR test value: 4744, p-value: &lt; 2.22e-16
Asymptotic standard error: 0.0026757
    z-value: 360.92, p-value: &lt; 2.22e-16
Wald statistic: 130270, p-value: &lt; 2.22e-16

Log likelihood: 114.3006 for error model
ML residual variance (sigma squared): 0.041559, (sigma: 0.20386)
Nagelkerke pseudo-R-squared: 0.94535 
Number of observations: 2275 
Number of parameters estimated: 12 
AIC: -204.6, (AIC for lm: 4537.4)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Test Moran residuos</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>res.err<span class="ot">=</span>fit.errdurb_del<span class="sc">$</span>residuals</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(res.err,nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  res.err  
weights: nb    

Moran I statistic standard deviate = 9.9861, p-value &lt; 2.2e-16
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.1104488178     -0.0004397537      0.0001233061 </code></pre>
</div>
</div>
<p>Lag espacial</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="do">## SDM Spatial Durbin Lag Model</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>fit.durb<span class="ot">=</span><span class="fu">lagsarlm</span>(rc_idelv <span class="sc">~</span> c_IEJ <span class="sc">+</span> c_IEM <span class="sc">+</span> c_IPJ <span class="sc">+</span> c_IRH<span class="sc">+</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>               IVI<span class="sc">+</span> ISV<span class="sc">+</span>l_vivienda<span class="sc">+</span>l_atractor<span class="sc">+</span>densidad_hec, </span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mz_estudio,</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">listw=</span>spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nb_mzs),</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">type=</span><span class="st">"lag"</span>,<span class="at">method=</span><span class="st">"eigen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.durb, <span class="at">Nagelkerke=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:sacsarlm(formula = rc_idelv ~ c_IEJ + c_IEM + c_IPJ + c_IRH + 
    IVI + ISV + l_vivienda + l_atractor + densidad_hec, data = mz_estudio, 
    listw = spdep::nb2listw(nb_mzs), type = "sac", method = "eigen")

Residuals:
      Min        1Q    Median        3Q       Max 
-2.078202 -0.076293  0.002771  0.085556  0.736343 

Type: sac 
Coefficients: (asymptotic standard errors) 
                Estimate  Std. Error z value  Pr(&gt;|z|)
(Intercept)   1.9442e+00  5.9304e-01  3.2784  0.001044
c_IEJ        -3.7680e-05  7.6257e-06 -4.9413 7.762e-07
c_IEM        -3.4337e-02  6.1710e-02 -0.5564  0.577925
c_IPJ        -3.8772e-02  2.9724e-02 -1.3044  0.192092
c_IRH        -2.6951e-03  3.1001e-02 -0.0869  0.930724
IVI          -8.9824e-03  1.6229e-01 -0.0553  0.955860
ISV          -1.5024e+00  5.5041e-01 -2.7296  0.006341
l_vivienda   -1.3060e-03  9.0092e-04 -1.4496  0.147162
l_atractor    2.3484e-03  7.3308e-04  3.2035  0.001358
densidad_hec  4.7751e-02  7.3658e-03  6.4828 9.006e-11

Rho: 0.86956
Asymptotic standard error: 0.019016
    z-value: 45.729, p-value: &lt; 2.22e-16
Lambda: 0.59768
Asymptotic standard error: 0.052188
    z-value: 11.452, p-value: &lt; 2.22e-16

LR test value: 5011, p-value: &lt; 2.22e-16

Log likelihood: 247.8068 for sac model
ML residual variance (sigma squared): 0.038922, (sigma: 0.19729)
Nagelkerke pseudo-R-squared: 0.95141 
Number of observations: 2275 
Number of parameters estimated: 13 
AIC: -469.61, (AIC for lm: 4537.4)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Test Moran residuos</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>res.lag<span class="ot">=</span>fit.durb<span class="sc">$</span>residuals</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(res.lag,nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  res.lag  
weights: nb    

Moran I statistic standard deviate = 3.1971, p-value = 0.0006942
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.0350557130     -0.0004397537      0.0001232666 </code></pre>
</div>
</div>
<p>Error y Lag espacial</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="do">## SAC Spatial Autocorrelation Model</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>fit.sac<span class="ot">=</span><span class="fu">sacsarlm</span>(rc_idelv <span class="sc">~</span> c_IEJ <span class="sc">+</span> c_IEM <span class="sc">+</span> c_IPJ <span class="sc">+</span> c_IRH<span class="sc">+</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>               IVI<span class="sc">+</span> ISV<span class="sc">+</span>l_vivienda<span class="sc">+</span>l_atractor<span class="sc">+</span>densidad_hec, </span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">data =</span> mz_estudio,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>               <span class="at">listw=</span>spdep<span class="sc">::</span><span class="fu">nb2listw</span>(nb_mzs),</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">type=</span><span class="st">"sac"</span>,<span class="at">method=</span><span class="st">"eigen"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">

</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit.sac, <span class="at">Nagelkerke=</span>T)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:sacsarlm(formula = rc_idelv ~ c_IEJ + c_IEM + c_IPJ + c_IRH + 
    IVI + ISV + l_vivienda + l_atractor + densidad_hec, data = mz_estudio, 
    listw = spdep::nb2listw(nb_mzs), type = "sac", method = "eigen")

Residuals:
      Min        1Q    Median        3Q       Max 
-2.078202 -0.076293  0.002771  0.085556  0.736343 

Type: sac 
Coefficients: (asymptotic standard errors) 
                Estimate  Std. Error z value  Pr(&gt;|z|)
(Intercept)   1.9442e+00  5.9304e-01  3.2784  0.001044
c_IEJ        -3.7680e-05  7.6257e-06 -4.9413 7.762e-07
c_IEM        -3.4337e-02  6.1710e-02 -0.5564  0.577925
c_IPJ        -3.8772e-02  2.9724e-02 -1.3044  0.192092
c_IRH        -2.6951e-03  3.1001e-02 -0.0869  0.930724
IVI          -8.9824e-03  1.6229e-01 -0.0553  0.955860
ISV          -1.5024e+00  5.5041e-01 -2.7296  0.006341
l_vivienda   -1.3060e-03  9.0092e-04 -1.4496  0.147162
l_atractor    2.3484e-03  7.3308e-04  3.2035  0.001358
densidad_hec  4.7751e-02  7.3658e-03  6.4828 9.006e-11

Rho: 0.86956
Asymptotic standard error: 0.019016
    z-value: 45.729, p-value: &lt; 2.22e-16
Lambda: 0.59768
Asymptotic standard error: 0.052188
    z-value: 11.452, p-value: &lt; 2.22e-16

LR test value: 5011, p-value: &lt; 2.22e-16

Log likelihood: 247.8068 for sac model
ML residual variance (sigma squared): 0.038922, (sigma: 0.19729)
Nagelkerke pseudo-R-squared: 0.95141 
Number of observations: 2275 
Number of parameters estimated: 13 
AIC: -469.61, (AIC for lm: 4537.4)</code></pre>
</div>
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Test Moran residuos</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>res.sac<span class="ot">=</span>fit.sac<span class="sc">$</span>residuals</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="fu">moran.test</span>(res.sac,nb)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Moran I test under randomisation

data:  res.sac  
weights: nb    

Moran I statistic standard deviate = 3.1971, p-value = 0.0006942
alternative hypothesis: greater
sample estimates:
Moran I statistic       Expectation          Variance 
     0.0350557130     -0.0004397537      0.0001232666 </code></pre>
</div>
</div>
</section>
</section>
</section>
<section id="referencias-de-capítulo" class="level2" data-number="7.4">
<h2 data-number="7.4" class="anchored" data-anchor-id="referencias-de-capítulo"><span class="header-section-number">7.4</span> Referencias de Capítulo:</h2>
<ul>
<li><p><a href="https://geo200cn.github.io/spatialreg.html#Why_run_a_spatial_regression">GEO 200CN: Quantitative Geography</a></p></li>
<li><p><a href="https://spatial.uchicago.edu/sites/spatial.uchicago.edu/files/10_specification_tests_2_slides.pdf">Spatial Regression 10. Specification Tests</a></p></li>
<li><p><a href="https://dces.wisc.edu/wp-content/uploads/sites/128/2013/08/W14_Anselin2007.pdf">Spatial Regression Analysis in R A Workbook - Luc Anselin</a></p></li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./autocorrelacion.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Autocorrelación Espacial</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./tarea_1.html" class="pagination-link">
        <span class="nav-page-text">Tarea 1</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">Copyright 2023, Denis Berroeta</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>